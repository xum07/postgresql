PostgreSQL(以下简称PG)在遇到异常并需要恢复丢失的数据，或者备机追赶主机，就会利用redo_log进行回放。本文将介绍回放的主要流程。

> 数据的记录和恢复也有着自身的算法，如IBM提出的ARIES算法(Algorithm for Recovery and Isolation Exploiting Semantics)。该算法的提出有一系列论文，发表时间大致在90年代，后续的PG等数据库系统基本都借鉴了其中的思想

对于一个根据日志进行数据恢复的流程，假如我们一开始并不熟知其具体实现，如果需要解决这个问题，需要依次解决以下问题：

1. 怎么确定从哪里开始回放日志？因为文件并不一定总是恰好记录完你需要的数据，更多的情况下，我们是先生成足够的文件，再往里面写数据，刚好redo_log就属于这种情况
2. 怎么解析读到的日志？
3. 日志里面记录的操作肯定有很多种，比如插入数据、更新索引、删表等等，这些该怎么处理？
4. 最后，应该到哪儿停止？

针对以上的问题，再来看PG怎么实现的

# 起止

开始和结束总是一对，所以这里先回答问题1和问题4

## 从哪儿开始



## 到哪儿结束



# 如何解析



# 谁来回放具体数据



# 参考资料

1. [回放分析（一）](http://mysql.taobao.org/monthly/2020/04/01/)
2. [ARIES事务恢复](https://zhuanlan.zhihu.com/p/143173278)